
\section{Numerical apparatus \label{sec:napp}}
\subsection{Adjoint discretization}
\upd{Let $X = L^2([0,L])$ and $\underline{X} = \mathbb{R}^{N}$.  Let $\left< \cdot, \cdot \right>_{X},\left< \cdot, \cdot \right>_{\underline{X}}$
denote the standard inner products on the Hilbert spaces $X,$ and $\underline{X}$ respectively.
The following lemma relates the discretization of the inverse of an operator to the adjoint of the discretization of its inverse. Its proof follows directly from the definition of the adjoint and is omitted.

\begin{lemma}\label{lem_adjm}
Suppose $A: X \to X$ is a bounded invertible operator and that $\uA: \uX \to \uX$ is the corresponding discretized operator such that
\begin{align}
\left| \langle f,A^{-1} g \rangle_{X} - \langle S[f],\uA^{-1} S[g] \rangle_{\uX} \right| \le \epsilon \|f\|_{X} \|g\|_{X},
\end{align}
for all $f$ and $g$ in some subspace $Y \subset L^2([0,L]).$  Then, for all functions $f$ and $g$ in $Y$
\begin{align}
\left| \langle f,(A^{-1})^T g \rangle_{X} - \langle S[f],\left(A^{-1}_\epsilon\right)^T S[g] \rangle_{\uX} \right| \le \epsilon \|f\|_{X} \|g\|_{X}
\end{align}
where $\,{{}^T}\,$ denotes the adjoint.
\end{lemma}
}

The following corollary follows immediately from the previous result.
\upd{
\begin{corollary}
Let $\uA$ be the $N\times N$ matrix obtained by discretizing the interior Dirichlet problem and $S_\epsilon$ be the collection of functions given by Definition \ref{def:seps}. Then for all functions $f,g \in S_\epsilon$
\begin{align}
\left| \langle S[g], (\uA^T)^{-1}S[f] \rangle - \int_0^L g(t)\,\sigma(t)\,{\rm d}t \right| < \epsilon \|f\|\, \|g\|,
\end{align}
where $\sigma$ is the solution to the exterior Neumann problem with boundary data $f$.
\end{corollary}
}

Hence a discretization of the Neumann problem can be obtained simply by taking the adjoint of the Dirichlet problem. The resulting density $\sigma$ obtained is accurate in a weak sense, i.e. its inner products against functions in $S_\epsilon$ are accurate to within an error of $\epsilon.$

We conclude this section with a few remarks. 

\begin{remark}
\label{rem:far-field-accuracy}
We observe that if the solution to the boundary value problem is being calculated at a point $\by \in \mathbb{R}^2\setminus \Omega$ more than one panel length away from the boundary curve $\Gamma$ then the Neumann density $\sigma$ obtained using the above result will give an accuracy of $\epsilon,$ i.e. the function $K(\by,\gamma(t)) \in S_\epsilon.$ Thus accurate values of the solution in the far-field can be obtained almost immediately.
\end{remark}
\begin{remark}
\label{rem:strong-sol-smooth}
Similarly, if the point $\by \in \mathbb{R}^2 \setminus \Omega$ at which the solution to the Neumann boundary value problem is to be calculated lies close to a smooth panel then the density $\sigma$ near that point can be interpolated to a finer set of quadrature points and the value of $u(\by)$ can once again be obtained to precision $\epsilon.$ We note, however, that in general the density in the vicinity of a corner cannot be interpolated accurately. This follows from the fact that the interpolation scheme constructed is only guaranteed to interpolate the powers arising in the Dirichlet problem accurately near the corner. The collection of singular powers arising in Neumann problems contain negative powers which are not contained in this set and hence are not interpolated accurately.
\end{remark}
{\color{blue}
\begin{remark}
In this approach, note that the discretization of the Neumann problem, inherits its spectral properties from the discretization of the corresponding adjoint Dirichlet problem (eigenvalues and singular values are the same, but eigenvectors and singular vectors may differ). Thus, when using an iterative method for solving the discrete linear system for the Dirichlet and Neumann problem, the number of iterations required for the relative residual to converge below $\varepsilon$ would be fairly similar. 
\end{remark}
}

\subsection{Weak corner re-solving \label{sec:resolve}}
In this section we address the problem highlighted in the previous one; namely, the accurate evaluation of the solution to the exterior Neumann problem in the vicinity of a corner. Our approach is based on the observation that the potential generated by the density on the boundary outside of a sufficiently small neighborhood of the corner is smooth when evaluated in the vicinity of the corner. This allows us to convert the problem of evaluating the potential near the corner (given the approximation to the density obtained using the adjoint approach described in the previous section) into a purely local one. In particular, we re-discretize only a small neighborhood of the corner which in turn allows us to evaluate the potential arbitrarily close to the corner to within a small factor of machine precision. 

In the following we assume that we are given a discretization of the interior Dirichlet boundary integral equation (\ref{bie_intd}) with nodes $x_1,\dots,x_N$ and corresponding weights $w_1,\dots,w_N.$ In particular, we assume that the discretization nodes are obtained by subdividing the boundary into panels. Those panels which contain a vertex are discretized using a custom discretization scheme (see Section \ref{sec:disc_dir}) while the remaining panels are discretized using a standard smooth quadrature rule (such as Gauss-Legendre or Chebyshev nodes). In the following we assume that an $M$-point Gauss-Legendre quadrature rule is used and the corner panels are discretized using \upd{$K$} nodes (together with a collection of orthonormal functions on that interval $\phi_1,\dots,\upd{\phi_K}$).

Additionally, we denote the discretization of the interior Dirichlet operator (using the custom quadratures described in Section \ref{sec:disc_dir}) by $\upd{\uA}.$ As before, let $\underline{f} = (f_1,\dots,f_N)^T$ where $f_i = f(x_i) \sqrt{w_i}$ and $f: \Gamma \to \mathbb{R}$ is the right-hand side of the exterior Neumann problem. Finally, let $\underline{\sigma}$ be the approximation to the density (scaled by the square roots of the weights) obtained by solving the linear system
\begin{align}\label{eqn:adj_linalg}
\upd{\uA}^T \underline{\sigma} = \underline{f}.
\end{align}
For notational convenience we let $\gamma:[-2\delta,L-2\delta] \to \Gamma$ be a counterclockwise arclength parametrization of $\Gamma$ such that  $\gamma(0)$ corresponds to a vertex and $\gamma([-\delta,\delta])$ corresponds to a corner panel.

For a panel $\gamma([s_1,s_2])$ with discretization nodes \upd{$x_i,\dots,x_{i+M-1}$} corresponding to a Gauss-Legendre panel the density is smooth and thus it is expected to be well-represented in the basis of Legendre polynomials (shifted and scaled to the interval $[s_1,s_2]$). Hence standard interpolation techniques can be used to obtain an accurate approximation to the density $\sigma$ on the interval $s_1 \le s\le s_2.$ \upd{In~\cref{sec:appb}, we show that the interpolation error in the density
at panels away from the corner is related to the interpolation error in the solution to a related Dirichlet boundary value problem.}

For corner panels the nodes were constructed to enable stable interpolation of densities $s^\mu,$ $\mu \in \{0\} \cup [1/2,50],$ on the interval $s \in (-\delta,\delta)$ - assuming for simplicity that the corner is at $0$ and the panel is of length $2 \delta.$ As mentioned above, the density is expected to contain terms of the form $s^\mu$ for some finite collection of $\mu$ in the interval $(-1/2,1/2),$ and hence will not in general be stably interpolable on the interval $(-\delta,\delta).$ However, it is possible to use the density obtained using (\ref{eqn:adj_linalg}) to construct a sequence of nested problems in the neighborhood of the corner, the solutions of which enable accurate interpolation of the density arbitrarily close to the vertex. The number of these problems depends only on the distance of the closest evaluation point to the corner. In particular, if $r$ is the smallest distance of an evaluation point from the corner then only $\log_2 r/\delta$ levels are required. Each problem involves the solution of a small linear system (typically less than $100 \times 100$) and as such can be performed quickly. Furthermore, we note that the algorithm can be easily parallelized to treat multiple corners concomitantly.

We begin with the following proposition, the proof of which follows immediately from the definition of the kernel $k$ and is omitted.
\begin{proposition}\label{prop_hanalytic}
Suppose that $f$ is a piecewise-analytic function in $S_\epsilon$ and  $\underline{\sigma} = (\upd{\uA}^T)^{-1} \upd{\uf}$ is the approximation to the Neumann density obtained using the adjoint of the discretization for the interior Dirichlet boundary integral equation. Further suppose that the discretization nodes are ordered so that $x_1,\dots,x_{2K}$ correspond to the corner panel associated with the interval $(-\delta,\delta),$ $x_{2K+1},\dots,x_{2K+M}$ correspond to the Gauss-Legendre panel immediately to the left associated with the interval $(-2\delta,-\delta),$ and $x_{2K+M+1},\dots,x_{2K+2M}$ to the Gauss-Legendre panel immediately to the right associated with the interval $(\delta,2\delta).$
Then
\begin{align}\label{eqn:def_hfun}
h(t) = \sum_{i=2K+2M+1}^N k(x_i,t) \sqrt{w_i} \,\underline{\sigma}_i
\end{align}
is an analytic function of $t$ for all $t \in (-2\delta,2\delta).$
\end{proposition}

In light of this we consider the following integral equation
\upd{
\begin{align}\label{eqn:resolve_neum0}
-\frac{\sigma(s)}{2} + \int_{-2\delta}^{2\delta} k(s,t) \sigma(t)\,{\rm d}t = f(s)-h(s), \quad -2\delta \le s \le 2\delta.
\end{align}
}
We note that the solution to (\ref{eqn:resolve_neum0}) is equal to the solution of the original boundary integral equation (\ref{bie_extn}) restricted to the interval $[-2\delta,2\delta].$ Taking the adjoint of (\ref{eqn:resolve_neum0}) we obtain
\upd{
\begin{align}\label{eqn:resolve_diri0}
-\frac{\sigma(s)}{2} + \int_{-2\delta}^{2\delta} k(t,s) \sigma(t)\,{\rm d}t = f(s)-h(s), \quad -2\delta \le s \le 2\delta,
\end{align}}
which is a Dirichlet boundary integral equation for a wedge with a piecewise analytic right-hand side. In particular, we can discretize the operator using the method summarized in the previous section. Specifically, we subdivide the interval $[-\delta,\delta]$ into three subintervals $I_0 = [-\delta,\delta/2],$ $L_0 = [-\delta/2,\delta/2],$ and $J_0 = [\delta/2,\delta].$ On $I_0$ and $J_0$ we place standard Gauss-Legendre discretization nodes, while on $L_0$ we use the custom discretization scheme for corners, outlined in Section \ref{sec:disc_dir} (see \cite{hoskins2019numerical} for a detailed description of the method). On the intervals $[-2\delta,-\delta]$ and $[\delta,2\delta]$ we use the same discretization nodes and weights as in the original system for those intervals. Let $\underline{f}_0$ denote the right-hand side of (\ref{eqn:resolve_neum0}) evaluated at these discretization nodes and scaled by the square roots of the corresponding weights. Let $\upd{\uA_0}$ be the discretization of the interior Dirichlet problem operator (i.e. the operator acting on $\sigma$ on the left-hand side of (\ref{eqn:resolve_diri0})). We note that due to the scale invariance of Laplace's equation for polygonal domains the portion of $\upd{\uA_0}$ corresponding to the self-interaction of $L_0$ is a submatrix of the original matrix $\upd{\uA}.$ All other blocks can be generated using the discretization nodes as quadrature nodes.

The analysis of the previous section then shows that if $\underline{\sigma}_0$ is the solution of the equation
\begin{align}\label{eqn_reduced}
\upd{\uA_0^T} \underline{\sigma}_0 = \underline{f}_0
\end{align}
then $\underline{\sigma}_0$ gives a {weak solution} to the integral equation (\ref{eqn:resolve_neum0}), i.e. for any function $g$ which is analytic on $[-2\delta,0]$ and $[0,2\delta]$ the inner product $\langle g,\sigma \rangle$ can be calculated to precision $\epsilon$ using the solution $\underline{\sigma}_0.$ Moreover, since the true density $\sigma$ is smooth on $[\delta,2\delta]$ and $[-2\delta,-\delta]$ the Gauss-Legendre discretization allows accurate interpolation of the density on those regions.

\upd{
\begin{remark}
Though the above method produces a viable method for reducing the problem, as written the reduction appears to be non-local --- in order to compute the right-hand side of the subproblem one must evaluate contributions from the rest of the domain. In fact, the values of $\underline{f}_0$ can be obtained using only local information. Specifically, we observe that
\begin{align}
\left(h(x_i) \sqrt{w_1}, \dots, h(x_{2K+2M}) \sqrt{w_{2K+2M}}\right)^T =& \left(f(k_i) \sqrt{w_1}, \dots, f(k_{2K+2M}) \sqrt{w_{2K+2M}}\right)^T-\\
& \underline{A}_{\rm red}^T \left(\sigma_1 \sqrt{w}_1,\dots, \sigma_{2K+2M} \sqrt{w_{2K+2M}}\right)^T,
\end{align}
where $\underline{A}_{\rm red}$ is the submatrix of $\underline{A}$ corresponding to the first $2K+2M$ rows and columns. Since $h$ is analytic on $(-2\delta,2 \delta),$ $h(t)$ can be accurately approximated for any $-2\delta<t<2\delta$ by interpolation from its values at the nodes $x_1,\dots,x_{2K+2M}.$
\end{remark}}

This can be iterated to obtain an interpolable approximation to the density on $[-\delta,\delta].$ In particular, we consider the restriction of the exterior Neumann integral equation, as well as its adjoint, to the interval $I_0$ and $J_0.$ For the right-hand side we use the original right-hand side $f$ minus the contribution from the remainder of the domain. In particular, if we define
\begin{align}
h_1(s) = \sum_{x_i \in K_0,Q_0} k(s,x_i) \sigma_0^{(i)} \sqrt{w_i}
\end{align}
then $\sigma$ restricted to the interval $I_0\cup L_0 \cup J_0$ satisfies
\upd{
\begin{align}\label{eqn:resolve_neum1}
-\frac{\sigma(s)}{2} + \int_{-\delta}^{\delta} k(s,t) \sigma(t)\,{\rm d} t = f(s)-h(s)-h_1(s), \quad -\delta \le s \le \delta.
\end{align}
}
The corresponding adjoint equation is given by 
\upd{
\begin{align}\label{eqn:resolve_diri1}
-\frac{\sigma(s)}{2} + \int_{-\delta}^{\delta} k(t,s) \sigma(t)\,{\rm d} t = f(s)-h(s)-h_1(s), \quad -\delta \le s \le \delta.
\end{align}
}
Once again, we divide $L_0$ into three intervals $I_1,$ $L_1,$ and $J_1$ and discretize each interval as before. After solving the corresponding discretization of (\ref{eqn:resolve_neum1}) using the adjoint of the discretization of the integral operator appearing in (\ref{eqn:resolve_diri1}) we obtain a weak solution of $\sigma$ on the interval $I_0\cup L_0 \cup J_0$ which can be interpolated on $I_0,$ and $J_0$ to within precision $\epsilon.$

This process can be repeated an arbitrary number of times to yield a sequence of solutions $\underline{\sigma}_j,$ $j=0,1,2,\dots$ together with corresponding intervals $I_0,I_1,\dots$ and $J_0,J_1,\dots$ on which each can be interpolated.

Note that if $\bx$ is a point a distance $r$ away from the corner then after $J=1+\log_2 r/d$ such subdivisions $\bx$ will be at least twice the corner panel length away from the corner. Thus $K(\bx,\cdot)$ will be smooth when restricted to the corner panel $[-\delta/2^{J},\delta/2^J]$ and hence will be integrated accurately using the corner panel discretization nodes and weights.
